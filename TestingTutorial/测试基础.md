# iOS å•å…ƒæµ‹è¯•å’Œ UI æµ‹è¯•å¿«é€Ÿå…¥é—¨

![](./src/preview.png)

## å‰è¨€

å¹³æ—¶å†™å®Œä¸šåŠ¡ä»£ç çš„æ—¶å€™éƒ½ä¼šå»è‡ªå·±æµ‹è¯•ä¸€éï¼Œåé¢æ¯æ¬¡æœ‰ä¿®æ”¹éƒ½éœ€è¦é‡å¤æµ‹ï¼Œä¸ç®¡æ˜¯ä¸€ä¸ªä¸šåŠ¡æµç¨‹è¿˜æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œå…¶å®éƒ½å¯ä»¥é€šè¿‡æµ‹è¯•æ¡†æ¶æ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆæµ‹è¯•ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›é¢‘ç¹ä¿®æ”¹çš„ä»£ç ï¼Œæ›´éœ€è¦ä¸¥è°¨çš„æµ‹è¯•ã€‚åœ¨æµ…æµ…åœ°å¯¹è‡ªåŠ¨åŒ–æµ‹è¯•æœ‰ä¸€äº›äº†è§£æ—¶ï¼Œè§‰å¾—å†™æµ‹è¯•ä»£ç æŒºè€—æ—¶é—´ï¼Œä½†å…¶å®å¯¹åæœŸçš„å¸®åŠ©æ˜¯éå¸¸å¤§çš„ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µæ¥å†³å®šå“ªäº›åœ°æ–¹éœ€è¦åŠ å…¥è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚

æœ¬æ–‡å†…å®¹é€‚åˆåˆšæ¥è§¦ iOS è‡ªåŠ¨åŒ–æµ‹è¯•çš„åŒå­¦ï¼ŒåŸºæœ¬å†…å®¹æ¥è‡ªäºå„å¹´ WWDC çš„å¤šä¸ª Sessionsï¼Œæœ¬æ–‡ä»£ç éƒ¨åˆ†åŸºäºæˆ‘çš„ä¸€ä¸ªå­¦ä¹  [Demo](./demo/)ï¼Œå–œæ¬¢çš„å¯ä»¥äº†è§£ä¸€ä¸‹ã€‚æœ¬æ–‡ä»‹ç»çš„å¤§è‡´å†…å®¹åŒ…æ‹¬ï¼š

1. å•å…ƒæµ‹è¯• 
* UI æµ‹è¯•
* æ‹“å±• Tips
* å·¥ç¨‹å¯æµ‹æ€§

## ä¸€ã€å•å…ƒæµ‹è¯•

### 1.1 åŠ å…¥æµ‹è¯• Target

åœ¨æ–°å»ºé¡¹ç›®æ—¶ï¼Œå‹¾é€‰``Include Unit Tests``å’Œ``Include UI Tests``,å³å¯ä¸ºé¡¹ç›®æ·»åŠ å•å…ƒæµ‹è¯•å’Œ UI æµ‹è¯•ã€‚

åœ¨æ·»åŠ æµ‹è¯•ä»£ç æ—¶ï¼Œä½ éœ€è¦éµå®ˆä¸€äº›æœ€åŸºæœ¬çš„è§„åˆ™ï¼š

* æ‰€æœ‰çš„æµ‹è¯•ç±»éœ€è¦ç»§æ‰¿``XCTestCase``

	```
	@interface TTTestCase : XCTestCase
	```

* æµ‹è¯•æ–¹æ³•å‘½åä»¥ test å¼€å§‹

	```
	- (void)testThatMyFunctionWorks
	```

* ç”¨ Assertion API è¿›è¡ŒéªŒè¯æ˜¯å¦é€šè¿‡

	```
	XCTAssertEqual(value, expectedValue)
	```


### 1.2 å¯åŠ¨æµ‹è¯•

å•å…ƒæµ‹è¯•çš„ç»“æ„ï¼š

* step1ï¼šå‡†å¤‡è¾“å…¥
* step2ï¼šè¿è¡Œæ­£åœ¨æµ‹è¯•çš„ä»£ç 
* step3ï¼šéªŒè¯è¾“å‡º


```
// å‡†å¤‡è¾“å…¥
NSString *dateString = @"2000-01-01";

// éœ€è¦æµ‹è¯•çš„æ–¹æ³•
BOOL isToday = [TTDateFormatter isTodayWithDateString:dateString];

// éªŒè¯è¾“å‡º
XCTAssert(isToday, @"isToday false");
```

ä»¥ä¸Šä¸‰ä¸ªéƒ¨åˆ†çš„ä»£ç å‡†å¤‡å®Œæˆåå³å¯å¼€å§‹æµ‹è¯•ï¼Œå¯åŠ¨çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œå¯ä»¥æ ¹æ®ä½ çš„å®é™…æƒ…å†µé€‰æ‹©ä»¥ä¸‹æ–¹å¼ï¼š

* ä»£ç ç¼–è¾‘å™¨è¾¹æ è±å½¢æŒ‰é’®ï¼Œæµ‹è¯•å•ä¸ªç”¨ä¾‹
* Test å¯¼èˆªæ ï¼Œæµ‹è¯•å•ä¸ªç”¨ä¾‹
* å¿«æ·é”®``âŒ˜ + U``æµ‹è¯•å…¨éƒ¨ç”¨ä¾‹
* ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· xcodebuild å¯ä»¥æµ‹è¯•å•ä¸ªç”¨ä¾‹ï¼Œä¹Ÿå¯ä»¥æµ‹è¯•å…¨éƒ¨ç”¨ä¾‹ã€‚

![123](./src/1.1.png)


### 1.3 æ€§èƒ½æµ‹è¯•

æ€§èƒ½æµ‹è¯•é€šè¿‡åº¦é‡ä»£ç å—æ‰§è¡Œæ‰€æ¶ˆè€—çš„æ—¶é—´é•¿çŸ­ï¼Œæ¥è¡¡é‡æ˜¯å¦é€šè¿‡æµ‹è¯•ã€‚

#### 1.3.1 å¦‚ä½•è¿›è¡Œæ€§èƒ½æµ‹è¯•

ç›¸å…³ API :

* measureBlock:

	```
	- (void)testPerformanceOfMyFunction {

        [self measureBlock:^{
            // Do that thing you want to measure.
            MyFunction();
        }];
    }
	```

* measureMetrics:automaticallyStartMeasuring:forBlock:

	```
    - (void)testMyFunction2_WallClockTime {
        [self measureMetrics:[self class].defaultPerformanceMetrics automaticallyStartMeasuring:NO forBlock:^{

            // Do setup work that needs to be done for every iteration but you don't want to measure before the call to -startMeasuring
            SetupSomething();
            [self startMeasuring];

            // Do that thing you want to measure.
            MyFunction();
            [self stopMeasuring];

            // Do teardown work that needs to be done for every iteration but you don't want to measure after the call to -stopMeasuring
            TeardownSomething();
        }];
    }
	```
	
#### 1.3.2 è®¾ç½®åŸºå‡†çº¿

æ‰€æœ‰çš„æ€§èƒ½æµ‹è¯•éœ€è¦è®¾ç½®ä¸€ä¸ª``Baseline``æ¥éªŒè¯æ˜¯å¦é€šè¿‡æµ‹è¯•ï¼Œæ²¡æœ‰è®¾ç½®çš„ä¼šæç¤º``No baseline average for Time``ã€‚

![1.2](./src/1.2.png)

æˆ‘ä»¬å¯ä»¥é€šè¿‡ç‚¹å‡»``measureBlock:``æ–¹æ³•å·¦è¾¹è±å½¢åœ†å¿ƒ icon ï¼Œæ¥è®¾ç½®``Baseline``,è®¾ç½®ä¹‹åéœ€è¦ç‚¹å‡»``save``ä¿å­˜ã€‚ä¹‹åå†æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œå¦‚æœæˆåŠŸï¼Œå·¦è¾¹çš„iconä¼šä»åœ†å¿ƒå˜æˆä¸€ä¸ª âœ…ã€‚

![1.2](./src/1.3.png)



### 1.4 å¼‚æ­¥æµ‹è¯•

ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨å¼‚æ­¥æµ‹è¯•ï¼š

* æ‰“å¼€æ–‡æ¡£ 
* åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œçš„æœåŠ¡å’Œç½‘ç»œæ´»åŠ¨
* æ‰§è¡ŒåŠ¨ç”»
* UI æµ‹è¯•æ—¶

#### 1.4.1 å¼‚æ­¥æµ‹è¯• XCTestExpectation

å¼‚æ­¥æµ‹è¯•åˆ†ä¸º3ä¸ªéƒ¨åˆ†ï¼š **æ–°å»ºæœŸæœ›** ã€ **ç­‰å¾…æœŸæœ›è¢«å±¥è¡Œ** å’Œ **å±¥è¡ŒæœŸæœ›** ã€‚

* XCTestExpectation ï¼šæµ‹è¯•æœŸæœ›ï¼Œå¯ä»¥ç”±æµ‹è¯•ç±»æŒæœ‰ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æŒæœ‰ï¼Œè‡ªå·±æŒæœ‰æµ‹è¯•æœŸæœ›æ—¶çµæ´»æ€§æ›´å¥½ä¸€äº›ï¼Œä½ å¯ä»¥é€‰æ‹©ç­‰å¾…å“ªäº›æœŸæœ›ã€‚

	```
	// æµ‹è¯•ç±»æŒæœ‰çš„åˆå§‹åŒ–æ–¹æ³•
	XCTestExpectation *expect1 = [self expectationWithDescription:@"asyncTest1"];
	
	// è‡ªå·±æŒæœ‰çš„åˆå§‹åŒ–æ–¹æ³•
	XCTestExpectation *expect2 = [[XCTestExpectation alloc] initWithDescription:@"asyncTest3"];
	```
	
* waitForExpectations:timeout: ï¼šç­‰å¾…å¼‚æ­¥çš„æœŸæœ›ä»£ç æ‰§è¡Œï¼Œæ ¹æ®åˆå§‹åŒ–æ–¹å¼ä¸åŒï¼Œç­‰å¾…çš„æ–¹æ³•ä¸åŒã€‚

	```
	// æµ‹è¯•ç±»æŒæœ‰æ—¶çš„ç­‰å¾…æ–¹æ³•
	[self waitForExpectationsWithTimeout:10.0 handler:nil];
	
	// è‡ªå·±æŒæœ‰æ—¶çš„ç­‰å¾…æ–¹æ³•
	[self waitForExpectations:@[expect3] timeout:10.0];
	```

* fulfill ï¼šå±¥è¡ŒæœŸæœ›ï¼Œå¹¶ä¸”é€‚å½“åŠ å…¥``XCTAssertTrue``ç­‰æ–­è¨€ï¼Œæ¥éªŒè¯æµ‹è¯•ç»“æœã€‚

	```
	XCTestExpectation *expect3 = [[XCTestExpectation alloc] initWithDescription:@"asyncTest3"];
    
    [TTFakeNetworkingInstance requestWithService:apiRecordList completionHandler:^(NSDictionary *response) {
        XCTAssertTrue([response[@"code"] isEqualToString:@"200"]);
        [expect3 fulfill];
    }];
    
    [self waitForExpectations:@[expect3] timeout:10.0];
	```

#### 1.4.2 å¼‚æ­¥æµ‹è¯• XCTWaiter

``XCTWaiter``æ˜¯ 2017 å¹´æ–°å¢çš„å¼‚æ­¥æµ‹è¯•æ–¹æ¡ˆï¼Œå¯ä»¥é€šè¿‡ä»£ç†æ–¹å¼æ¥å¤„ç†å¼‚å¸¸æƒ…å†µã€‚

```
XCTWaiter *waiter = [[XCTWaiter alloc] initWithDelegate:self];
    
XCTestExpectation *expect4 = [[XCTestExpectation alloc] initWithDescription:@"asyncTest3"];
    
[TTFakeNetworkingInstance requestWithService:@"product.list" completionHandler:^(NSDictionary *response) {
	XCTAssertTrue([response[@"code"] isEqualToString:@"200"]);
	expect4 fulfill];
}];

XCTWaiterResult result = [waiter waitForExpectations:@[expect4] timeout:10 enforceOrder:NO];

XCTAssert(result == XCTWaiterResultCompleted, @"failure: %ld", result);
```

XCTWaiterDelegateï¼šå¦‚æœå§”æ‰˜æ˜¯``XCTestCase``å®ä¾‹ï¼Œä¸‹æ–¹ä»£ç†è¢«è°ƒç”¨æ—¶ä¼šæŠ¥å‘Šä¸ºæµ‹è¯•å¤±è´¥ã€‚
	

```
// å¦‚æœæœ‰æœŸæœ›è¶…æ—¶ï¼Œåˆ™è°ƒç”¨ã€‚ 
- (void)waiter:(XCTWaiter *)waiter didTimeoutWithUnfulfilledExpectations:(NSArray<XCTestExpectation *> *)unfulfilledExpectations;

// å½“å±¥è¡Œçš„æœŸæœ›è¢«å¼ºåˆ¶è¦æ±‚æŒ‰é¡ºåºå±¥è¡Œï¼Œä½†æœŸæœ›ä»¥é”™è¯¯çš„é¡ºåºè¢«å±¥è¡Œï¼Œåˆ™è°ƒç”¨ã€‚
- (void)waiter:(XCTWaiter *)waiter fulfillmentDidViolateOrderingConstraintsForExpectation:(XCTestExpectation *)expectation requiredExpectation:(XCTestExpectation *)requiredExpectation;

// å½“æŸä¸ªæœŸæœ›è¢«æ ‡è®°ä¸ºè¢«å€’ç½®ï¼Œåˆ™è°ƒç”¨ã€‚ 
- (void)waiter:(XCTWaiter *)waiter didFulfillInvertedExpectation:(XCTestExpectation *)expectation;

// å½“ waiter åœ¨ fullfill å’Œè¶…æ—¶ä¹‹å‰è¢«æ‰“æ–­ï¼Œåˆ™è°ƒç”¨ã€‚ 
- (void)nestedWaiter:(XCTWaiter *)waiter wasInterruptedByTimedOutWaiter:(XCTWaiter *)outerWaiter;
```


### 1.5 æŸ¥çœ‹æµ‹è¯•ç»“æœ

åœ¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹åï¼ŒXcode ä¼šè¿”å›ç»™æˆ‘ä»¬æµ‹è¯•ç»“æœï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸‹é€”å¾„æŸ¥çœ‹ï¼š

* Test å¯¼èˆªæ 
* Issue å¯¼èˆªæ 
* ä»£ç ç¼–è¾‘å™¨å·¦è¾¹æ 
* Report å¯¼èˆªæ 

![æŸ¥çœ‹æµ‹è¯•ç»“æœ](./src/1.4.png)

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ Report å¯¼èˆªæ ä¸­æŸ¥çœ‹æ›´åŠ è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š:

- æµ‹è¯•é€šè¿‡/å¤±è´¥ 
- å¤±è´¥åŸå›  
- æ€§èƒ½æŒ‡æ ‡ 
- æˆªå±
- åµŒå¥—çš„ activities
- æµ‹è¯•è¦†ç›–ç‡

![](./src/1.5.png)

### 1.6 è¿›è¡Œå•å…ƒæµ‹è¯•

æˆ‘æ–°å»ºä¸€ä¸ªæ—¶é—´å·¥å…·ç±»ï¼Œå¸®åŠ©æˆ‘è½¬æ¢æ—¶é—´ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¿›è¡Œæµ‹è¯•ï¼Œä»¥ä¿è¯åŠŸèƒ½å®Œæ•´ä¸”æ­£ç¡®ã€‚

è¿™ä¸ªå·¥å…·ç±»æœ‰ä»¥ä¸‹ 4 ä¸ªå…¬å…±æ–¹æ³•ï¼Œ

```
@interface TTDateFormatter : NSDate

+ (NSString *)stringFormatWithDate:(NSDate *)date;

+ (NSDate *)dateFormatWithString:(NSString *)dateString;

+ (BOOL)isTodayWithDateString:(NSString *)dateString;

+ (NSString *)getHowLongAgoWithTimeStamp:(NSTimeInterval)timeStamp;

@end
```

é’ˆå¯¹ä¸€ä¸ªå·¥å…·ç±»çš„æµ‹è¯•æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ª``TTDateFormatterTests``æµ‹è¯•ç±»ï¼Œç»§æ‰¿ä¸€ä¸ªæµ‹è¯•åŸºç±»ã€‚å†æ ¹æ®ä¸åŒçš„æ–¹æ³•å†™ä¸åŒçš„æµ‹è¯•æ–¹æ³•ã€‚å¦‚æœæœ‰``if``å’Œ``switch``ç­‰æ¡ä»¶è¯­å¥å¯¼è‡´é€»è¾‘åˆ†æ”¯çš„ä»£ç ï¼Œå°½é‡ä½¿å„ä¸ªé€»è¾‘åˆ†æ”¯éƒ½èƒ½æµ‹è¯•åˆ°ï¼Œå¯ä»¥é…åˆä»£ç è¦†ç›–ç‡æ¥æ£€æŸ¥å“ªäº›é€»è¾‘åˆ†æ”¯æœªæµ‹è¯•ã€‚

```
@interface TTDateFormatterTests : TTTestCase
@end

@implementation TTDateFormatterTests

- (void)testDateFormatter {
    NSString *originDateString = @"2018-06-06 20:20:20";
    NSDate *date = [TTDateFormatter dateFormatWithString:originDateString];
    NSString *dateString = [TTDateFormatter stringFormatWithDate:date];
    XCTAssertEqualObjects(dateString, originDateString);
}

- (void)testDateFormatterIsToday {
    NSString *dateString = [TTDateFormatter stringFormatWithDate:[NSDate date]];
    XCTAssertTrue([TTDateFormatter isTodayWithDateString:dateString]);
    XCTAssertFalse([TTDateFormatter isTodayWithDateString:@"2000-01-01"]);
}

- (void)testDateFormatterHowLongAgo {
	// è¯¥æ–¹æ³•ä¸­åŒ…å«ä¸€ä¸ª switch ï¼Œè¦ä¿è¯ switch æ¯ä¸ªé€»è¾‘åˆ†æ”¯éƒ½æµ‹è¯•åˆ°ï¼Œæ‰€ä»¥éœ€è¦å¤šä¸ªæµ‹è¯•ã€‚
    NSDate *now = [NSDate date];
    NSString *secAgo = [TTDateFormatter getHowLongAgoWithTimeStamp:now.timeIntervalSince1970 - 10 * sec];
    XCTAssertEqualObjects(secAgo, @"10ç§’å‰");
    
    NSString *minAgo = [TTDateFormatter getHowLongAgoWithTimeStamp:now.timeIntervalSince1970 - 15 * min];
    XCTAssertEqualObjects(minAgo, @"15åˆ†é’Ÿå‰");
    
    NSString *hourAgo = [TTDateFormatter getHowLongAgoWithTimeStamp:now.timeIntervalSince1970 - 20 * hour];
    XCTAssertEqualObjects(hourAgo, @"20å°æ—¶å‰");

    NSString *dayAgo = [TTDateFormatter getHowLongAgoWithTimeStamp:now.timeIntervalSince1970 - 25 * hour];
    XCTAssertEqualObjects(dayAgo, @"1å¤©å‰");

    NSString *daysAgo = [TTDateFormatter getHowLongAgoWithTimeStamp:now.timeIntervalSince1970 - 50 * hour];
    XCTAssertEqualObjects(daysAgo, @"2å¤©å‰");

    NSString *longTimeAgo = [TTDateFormatter getHowLongAgoWithTimeStamp:1544002463];
    XCTAssertEqualObjects(longTimeAgo, @"2018-12-05 17:34:23");
}
@end
```

åˆç†ä½¿ç”¨æµ‹è¯•åŸºç±»å’Œæµ‹è¯•å·¥å…·ç±»ï¼Œå¯ä»¥é¿å…å¤§é‡é‡å¤æµ‹è¯•ä»£ç ã€‚æ—¶é—´è½¬æ¢å·¥å…·ç±»æ˜¯ä¸€ä¸ªæ²¡æœ‰å¤–éƒ¨ä¾èµ–çš„ç±»ï¼Œå½“ä¸€äº›å¯¹å¤–éƒ¨æœ‰ä¾èµ–çš„ç±»éœ€è¦æµ‹è¯•æ—¶ï¼Œå¯ä»¥å°è¯• [OCMock](https://github.com/erikdoe/ocmock) ï¼Œå®ƒèƒ½å¸®åŠ©ä½ æ¨¡æ‹Ÿæ•°æ®ã€‚å¦å¤–ï¼Œå½“ä½ è§‰å¾—æµ‹è¯•æ¡†æ¶æä¾›çš„æ–­è¨€æ–¹æ³•æ— æ³•æ»¡è¶³ä½ æ—¶ï¼Œä¹Ÿå¯ä»¥è¯•ç€ä½¿ç”¨ [OCHamcrest](https://github.com/hamcrest/OCHamcrest) ã€‚

## äºŒã€UI æµ‹è¯•

ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨ UI æµ‹è¯•ï¼š

* å•å…ƒæµ‹è¯•æ— æ³•è¦†ç›–æ—¶çš„è¡¥å……æ–¹æ¡ˆ
* å•å…ƒæµ‹è¯•æ›´ç²¾å‡†
* UI æµ‹è¯•è¦†ç›–é¢çš„æ›´å…¨

UI æµ‹è¯•çš„æ­¥éª¤ï¼š

* step1ï¼šä¸è¦æµ‹è¯•æˆ–ä¸é€»è¾‘æœ‰å…³çš„ UI è¿›è¡Œäº’åŠ¨
* step2ï¼šéªŒè¯ UIelements å±æ€§å’ŒçŠ¶æ€
    
    
### 2.1 UI Recording

é€šè¿‡ UI Recording ï¼Œå¯ä»¥å°†ä½ æ“ä½œæ‰‹æœºçš„è¡Œä¸ºè®°å½•ä¸‹æ¥ï¼Œå¹¶ä¸”è½¬æ¢æˆä»£ç ï¼Œå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿç”Ÿæˆ UI æµ‹è¯•ä»£ç ã€‚

é€‰ä¸­ UI æµ‹è¯•ç±»ï¼Œä½ èƒ½å†ä¸‹æ–¹çœ‹åˆ°ä¸€ä¸ªå°çº¢ç‚¹ï¼Œç‚¹å‡»å°çº¢ç‚¹å¼€å§‹å½•åˆ¶ä½ çš„äº¤äº’ã€‚

![](./src/2.1.png)

åœ¨ä½ è¿›è¡Œäº¤äº’æ—¶ï¼ŒXcode ä¼šè‡ªåŠ¨è½¬åŒ–æˆä»£ç ï¼Œä½ å¯ä»¥å€Ÿæ­¤åˆ›å»ºæ–°çš„æµ‹è¯•ä»£ç ï¼Œä¹Ÿå¯ä»¥ä»¥æ­¤æ‹“å±•å·²ç»å­˜åœ¨çš„æµ‹è¯•ä»£ç ã€‚å½“ç„¶å®ƒä¹Ÿä¸æ˜¯ååˆ†å®Œç¾ï¼Œå¹¶ä¸æ˜¯æ€»èƒ½å¦‚ä½ æ‰€æ„¿ï¼Œè¿˜éœ€è¦ä½ åšä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚è¯´è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç è¿‡äºç¹çï¼Œä½ å¯ä»¥ç”¨ä¸€äº›æ›´ç®€æ´çš„ä»£ç å®ç°ã€‚å³ä½¿è¿™æ ·ï¼ŒUI Recording ä¹Ÿæ˜¯éå¸¸é«˜æ•ˆçš„æ–¹å¼ã€‚

     

### 2.2 UI æµ‹è¯•ç›¸å…³çš„ç±»

#### 2.2.1 XCUIApplication

``XCUIApplication``å¯ä»¥è¿”å›ä¸€ä¸ªåº”ç”¨ç¨‹åºå®ä¾‹ï¼Œç„¶åä½ å°±å¯ä»¥é€šè¿‡æµ‹è¯•ä»£ç å¯åŠ¨åº”ç”¨ç¨‹åºã€‚

```
// è¿”å› UI æµ‹è¯• Target è®¾ç½®ä¸­é€‰ä¸­çš„ Target Application çš„å®ä¾‹
- (instancetype)init;

// æ ¹æ® bundleId è¿”å›ä¸€ä¸ªåº”ç”¨ç¨‹åºå®ä¾‹
- (instancetype)initWithBundleIdentifier:(NSString *)bundleIdentifier;

// å¯åŠ¨åº”ç”¨ç¨‹åº
- (void)launch;

// å°†åº”ç”¨ç¨‹åºå”¤é†’è‡³å‰å°ï¼Œåœ¨å¤šç¨‹åºè”åˆæµ‹è¯•ä¸‹ä¼šç”¨åˆ° 
- (void)activate;

// ç»“æŸä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åº
- (void)terminate;
```

#### 2.2.2 XCUIElement

åº”ç”¨ç¨‹åºä¸­çš„ UI æ§ä»¶ï¼Œæ§ä»¶ç±»å‹å¤šæ ·ï¼Œå¯èƒ½æ˜¯``Button``,``Cell``,``Window``ç­‰ç­‰ã€‚è¯¥ç±»å®ä¾‹æœ‰å¾ˆå¤šæ¨¡æ‹Ÿäº¤äº’çš„æ–¹æ³•ï¼Œå¦‚``tap``æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»äº‹ä»¶ï¼Œ``swipe``æ¨¡æ‹Ÿæ»‘åŠ¨äº‹ä»¶ï¼Œ``typeText:``æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥å†…å®¹ã€‚

åœ¨ UI æµ‹è¯•ä¸­æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æŸä¸ªç©ºé—´ï¼Œå¯ä»¥é€šè¿‡ä»–ä»¬çš„ç±»å‹æ¥ç¼©å°èŒƒå›´ï¼Œæ¯”å¦‚å½“å‰é¡µé¢æœ‰ä¸”åªæœ‰ä¸€ä¸ª``UITextView``æ§ä»¶ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥è·å–ï¼š

```
XCUIApplication *app = [[XCUIApplication alloc] init];
[app launch];

// å¦‚æœæ˜¯ Cell åˆ™å¯¹åº” app.cells 
// firstMatch è¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆçš„æ§ä»¶
XCUIElement *textView = app.textViews.firstMatch;

// æ¨¡æ‹Ÿç”¨æˆ·åœ¨ textView è¾“å…¥å†…å®¹
[textView typeText:@"input string"];
```

å¦å¤–è¿˜æœ‰ä¸€ç§æ–¹å¼é€šè¿‡ Accessibility identiferï¼Œ labelï¼Œ title ç­‰ç­‰æ–¹å¼æ¥å®šä½å¯¹åº”çš„æ§ä»¶ï¼Œå¦‚å¯»æ‰¾ä¸€ä¸ªåä¸º Add çš„``button``ã€‚

```
// éœ€è¦å‹¾é€‰ Accessibility Enabled ï¼Œå¹¶ä¸”åœ¨ Label ä¸€æ å¡«å…¥ Add
XCUIElement *addButton = app.buttons[@"add"];
// æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»æŒ‰é’®
[addButton tap];
```


![](./src/2.2.png)

é€šè¿‡ç±»å‹åŠ  identifier çš„æ–¹å¼æ¥å®šä½çš„æ§ä»¶å…ƒç´ çš„æ–¹å¼ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°åœºæ™¯ã€‚


#### 2.2.3 XCUIElementQuery

``XCUIElementQuery``æ˜¯ä¸€ä¸ªç”¨æ¥å®šä½æ§ä»¶å…ƒç´ çš„ç±»ï¼Œä¸€èˆ¬æ˜¯ä¸€ç»„ç¬¦åˆç­›é€‰æ¡ä»¶çš„å…ƒç´ é›†åˆã€‚å¦‚``app.buttons``å³è¿”å› XCUIElementQuery å®ä¾‹ï¼Œæ˜¯åŒ…å«äº†å½“å‰æ‰€æœ‰çš„``button``çš„é›†åˆï¼Œä½ å¯ä»¥å†é€šè¿‡ ``XCUIElementQuery``çš„æ–¹æ³•åšä¸‹ä¸€æ­¥çš„ç­›é€‰ã€‚

XCUIElementQuery å¸¸è§å®šä½å…ƒç´ çš„æ–¹æ³•ï¼š

* countï¼šåŒ¹é…çš„æ•°é‡;
	
	```
	// å½“ navigationBars çš„ count ç­‰äº 1 æ—¶ï¼Œä½ å¯ä»¥ç›´æ¥å®šä½åˆ° navigationBar
	app.navigationBars.element 
	```
	
* subscriptingï¼šé€šè¿‡ id æ¥å®šä½

	```
	table.staticTexts["Groceries"] 
	```

* indexï¼šé€šè¿‡å…ƒç´ çš„ä¸‹æ ‡æ¥å®šä½

	```
	table.staticTexts.elementAtIndex(0) 
	```


å®šä½å…ƒç´ é™¤äº†åˆ©ç”¨å…ƒç´ ç±»å‹ã€Accessibility Identifiersï¼ŒPredicates ç­‰ç­›é€‰æ–¹æ³•ï¼Œè¿˜å¯ä»¥ç»“åˆåµŒå¥—çš„å±‚çº§å…³ç³»æ¥å¸®åŠ©å®šä½ã€‚


### 2.3 è¿›è¡Œ UI æµ‹è¯•

è¦è¿›è¡Œ UI æµ‹è¯•éœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

* step1ï¼šæ–°å»ºä¸€ä¸ª UI æµ‹è¯• Targetã€‚
* step2ï¼šä½¿ç”¨ UI Recording æˆ–æ‰‹å†™ä»£ç ï¼Œå®šä½ UI å…ƒç´ ï¼Œå¹¶ä¸”æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’äº‹ä»¶ã€‚
* step3ï¼šåŠ å…¥``XCTAssert``ç­‰æ–­è¨€é€»è¾‘ï¼ŒéªŒè¯æµ‹è¯•æ˜¯å¦é€šè¿‡ã€‚

```
let app = XCUIApplication()
// å¯åŠ¨ app
app.launch()

// å®šä½å…ƒç´ 
let addButton = app.buttons[â€œAddâ€]

// æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’äº‹ä»¶
addButton.tap()

// éªŒè¯æµ‹è¯•æ˜¯å¦é€šè¿‡
XCTTAssertionEqual(app.tables.cells.cout, 1)
```

å¤§å¤šæ•° UI æµ‹è¯•éƒ½æ˜¯åŸºäºç”¨æˆ·è¡Œä¸ºé©±åŠ¨ï¼Œæ ¹æ®è®¾è®¡å¥½çš„ç”¨æˆ·çš„æ“ä½œæµç¨‹ï¼Œæµ‹è¯•æ•´ä¸ªæµç¨‹çš„ç»“æœã€‚æˆ‘è®¾è®¡äº†ä¸€ä¸ªç®€å•çš„ç¬”è®°ï¼Œä¸»è¦æœ‰ 3 æ­¥æ“ä½œï¼Œåˆ†åˆ«æ˜¯åˆ›å»ºç¬”è®°ã€å±•ç¤ºç¬”è®°å’Œåˆ é™¤ç¬”è®°ï¼Œä¸‹é¢ä¸€èµ·æ¥çœ‹çœ‹å¦‚ä½•è¿›è¡Œæµ‹è¯•ã€‚

![](./src/2.3.png)

```
// æµ‹è¯•ä¸»æµç¨‹
- (void)testMainFlow {
	// å¯åŠ¨ app
    XCUIApplication *app = [[XCUIApplication alloc] init];
    [app launch];
    
    // æ·»åŠ ç¬”è®°
    [self addRecordWithApp:app msg:@"ä»Šå¤©å¤©æ°”çœŸå¥½ï¼ğŸŒ"];
    [self addRecordWithApp:app msg:@"ä»Šå¤©è©¹å§†æ–¯ç‰¹åˆ«ç»™åŠ›ï¼Œå¸¦é¢†çƒé˜Ÿèµ°å‘èƒœåˆ©ã€‚âœŒï¸"];
	
    while (app.cells.count > 0) {
    	  // åˆ é™¤ç¬”è®°  
        [self deleteFirstRecordWithApp:app];
    }
}

/**
 æ·»åŠ ç¬”è®°

 @param app app å®ä¾‹
 @param msg ç¬”è®°å†…å®¹
 */
- (void)addRecordWithApp:(XCUIApplication *)app msg:(NSString *)msg {
	// æš‚å­˜å½“å‰ cell æ•°é‡
    NSInteger cellsCount = app.cells.count;
    
    // è®¾ç½®ä¸€ä¸ªé¢„æœŸ åˆ¤æ–­ app.cells çš„ count å±æ€§ä¼šç­‰äº cellsCount+1ï¼Œ ç­‰å¾…ç›´è‡³å¤±è´¥ï¼Œå¦‚æœç¬¦åˆåˆ™ä¸å†ç­‰å¾…
    NSPredicate *predicate = [NSPredicate predicateWithFormat:@"count == %d",cellsCount+1];
    [self expectationForPredicate:predicate evaluatedWithObject:app.cells handler:nil];


	 // å®šä½å¯¼èˆªæ +å·æŒ‰é’®ï¼Œç‚¹å‡»è¿›å…¥æ·»åŠ ç¬”è®°é¡µé¢ 
    XCUIElement *addButton = app.navigationBars[@"Record List"].buttons[@"Add"];
    [addButton tap];
    
    // æµ‹è¯• æœªè¾“å…¥ä»»ä½•å†…å®¹ç‚¹å‡»ä¿å­˜
    [app.navigationBars[@"Write Anything"].buttons[@"Save"] tap];
    
    // å®šä½æ–‡æœ¬è¾“å…¥æ¡† è¾“å…¥å†…å®¹
    XCUIElement *textView = app.textViews.firstMatch;
    [textView typeText:msg];
    
    // ä¿å­˜
    [app.navigationBars[@"Write Anything"].buttons[@"Save"] tap];
        
    // ç­‰å¾…é¢„æœŸ
    [self waitShortTimeForExpectations];
}

/**
 åˆ é™¤æœ€è¿‘ä¸€ä¸ªç¬”è®°

 @param app app å®ä¾‹
 */
- (void)deleteFirstRecordWithApp:(XCUIApplication *)app {
    NSInteger cellsCount = app.cells.count;
    
    
    NSPredicate *predicate = [NSPredicate predicateWithFormat:@"count == %d",cellsCount-1];
    // è®¾ç½®ä¸€ä¸ªé¢„æœŸ åˆ¤æ–­ app.cells çš„ count å±æ€§ä¼šç­‰äº cellsCount-1ï¼Œ ç­‰å¾…ç›´è‡³å¤±è´¥ï¼Œå¦‚æœç¬¦åˆåˆ™ä¸å†ç­‰å¾…
    [self expectationForPredicate:predicate evaluatedWithObject:app.cells handler:nil];

	// å®šä½åˆ° cell å…ƒç´ 
    XCUIElement *firstCell = app.cells.firstMatch;
    
    // å·¦æ»‘å‡ºç°åˆ é™¤æŒ‰é’®
    [firstCell swipeLeft];
    
    // å®šä½åˆ é™¤æŒ‰é’®
    XCUIElement *deleteButton = [app.buttons matchingIdentifier:@"Delete"].firstMatch;
    
    // ç‚¹å‡»åˆ é™¤æŒ‰é’®
    if (deleteButton.exists) {
        [deleteButton tap];        
    }
    
    // ç­‰å¾…é¢„æœŸ
    [self waitShortTimeForExpectations];

}
```

åœ¨ä¸Šé¢çš„é€»è¾‘ä¸­æ¶‰åŠåˆ°å¼‚æ­¥çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ©ç”¨``expectationForPredicate:evaluatedWithObject:handler:``æ–¹æ³•ç›‘å¬``app.cells``çš„``count``å±æ€§ï¼Œå½“æ»¡è¶³``NSPredicate ``æ¡ä»¶æ—¶ï¼Œ``expectation``ç›¸å½“äºè‡ªåŠ¨``fullfill``ã€‚å¦‚æœä¸€ç›´ä¸æ»¡è¶³æ¡ä»¶ï¼Œä¼šä¸€ç›´ç­‰å¾…ç›´è‡³è¶…æ—¶ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥ç”¨é€šçŸ¥å’Œ KVO çš„æ–¹å¼å®ç°ã€‚

æµ‹è¯•è¿‡ç¨‹:

![](./src/2.4.gif)


## ä¸‰ã€ æ‹“å±• Tips

### 3.1 å¤šåº”ç”¨è”åˆæµ‹è¯•


å¤šåº”ç”¨è”åˆæµ‹è¯•æ—¶ï¼Œä¾èµ–``XCUIApplication``ç±»çš„ä»¥ä¸‹ 2 ä¸ªæ–¹æ³•ï¼š

- initWithBundleIdentifier:
- activate

å‰è€…å¯ä»¥æ ¹æ® BundleId è·å–å…¶ä»– App çš„å®ä¾‹ï¼Œè®©æˆ‘ä»¬å¯ä»¥å¯åŠ¨å…¶ä»– Appã€‚åè€…å¯ä»¥è®© App ä»åå°åˆ‡æ¢è‡³å‰å°ï¼Œåœ¨å¤šåº”ç”¨é—´åˆ‡æ¢ã€‚ç®€å•å®ç°ä»£ç å¦‚ä¸‹ï¼š


```
// è¿”å› UI æµ‹è¯• Target è®¾ç½®ä¸­é€‰ä¸­çš„ Target Application çš„å®ä¾‹
XCUIApplication *ttApp = [[XCUIApplication alloc] init];

// ä½¿ç”¨ BundleId è·å¾—å¦å¤–ä¸€ä¸ª App å®ä¾‹
XCUIApplication *anotherApp = [[XCUIApplication alloc] initWithBundleIdentifier:@"Another.App.BundleId"];

// å…ˆå¯åŠ¨æˆ‘ä»¬çš„ä¸» App
[ttApp launch];

// åšä¸€ç³»åˆ—æµ‹è¯•

// å¯åŠ¨å¦ä¸€ä¸ª App
[anotherApp launch];

// åšä¸€ç³»åˆ—æµ‹è¯•

// å›åˆ°æˆ‘ä»¬çš„ä¸» App (åœ¨ App æœªå¯åŠ¨çš„æƒ…å†µä¸‹è°ƒ activate ä¼šè®© App å¯åŠ¨)
[ttApp activate];
```

### 3.2 é€»è¾‘å¤æ‚åœºæ™¯ä¸‹çš„ Activities 

åœ¨ä¸€äº›é€»è¾‘æ¯”è¾ƒå¤æ‚çš„æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©``XCTContext``ç±»æ¥å¸®æˆ‘ä»¬æŠŠæµ‹è¯•é€»è¾‘åˆ†å‰²æˆå¤šä¸ªå°çš„æµ‹è¯•æ¨¡å—ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸šåŠ¡ï¼Œå…³è”å¤šä¸ªæ¨¡å—ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ç”¨ç±»ä¼¼ä¸‹é¢çš„ä»£ç æ¥å¤„ç†ï¼š

```
// æ¨¡å— 1
[XCTContext runActivityNamed:@"step1" block:^(id<XCTActivity>  _Nonnull activity) {
    XCTestExpectation *expect1 = [self expectationWithDescription:@"asyncTest1"];

    [TTFakeNetworkingInstance requestWithService:apiRecordSave completionHandler:^(NSDictionary *response) {
        XCTAssertTrue([response[@"code"] isEqualToString:@"200"]);
        [expect1 fulfill];
    }];
    
}];

// æ¨¡å— 2
[XCTContext runActivityNamed:@"step2" block:^(id<XCTActivity>  _Nonnull activity) {
    XCTestExpectation *expect2 = [self expectationWithDescription:@"asyncTest2"];

    [TTFakeNetworkingInstance requestWithService:apiRecordDelete completionHandler:^(NSDictionary *response) {
        XCTAssertTrue([response[@"code"] isEqualToString:@"200"]);
        [expect2 fulfill];
    }];
    
}];

[self waitShortTimeForExpectations];
```

å¦‚æœæµ‹è¯•æˆåŠŸï¼Œå¯ä»¥åœ¨ Report å¯¼èˆªæ çœ‹åˆ°æˆåŠŸä¿¡æ¯ï¼Œå®ƒä¼šæŒ‰ç…§ä½ è®¾ç½®çš„æ¨¡å—åˆ†åˆ«å±•ç¤ºæµ‹è¯•ç»“æœã€‚

![](./src/3.1.png)

å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œä½ å¯ä»¥çœ‹åˆ°å“ªäº›æ¨¡å—æ˜¯æˆåŠŸçš„ï¼Œå’Œåœ¨å“ªäº›æ¨¡å—ä¸­å¤±è´¥äº†ã€‚

![](./src/3.2.png)

é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥å°è¯•å¤šå±‚åµŒå¥—ï¼Œactivity é‡Œé¢åµŒå¥— activityã€‚

### 3.3 æˆªå±

åœ¨ UI æµ‹è¯•ä¸­æœ‰ 2 ç§ç±»å‹æ”¯æŒé€šè¿‡ä»£ç æˆªå±ï¼Œåˆ†åˆ«æ˜¯``XCUIElement``å’Œ``XCUIScreen``ã€‚

```
// è·å–ä¸€ä¸ªæˆªå±å¯¹è±¡
XCUIScreenshot *screenshot = [app screenshot];

// å®ä¾‹åŒ–ä¸€ä¸ªé™„ä»¶å¯¹è±¡ å¹¶ä¼ å…¥æˆªå±å¯¹è±¡
XCTAttachment *attachment = [XCTAttachment attachmentWithScreenshot:screenshot];

// é™„ä»¶çš„å­˜å‚¨ç­–ç•¥ å¦‚æœé€‰æ‹© XCTAttachmentLifetimeDeleteOnSuccess åˆ™æµ‹è¯•æˆåŠŸçš„æƒ…å†µä¼šè¢«åˆ é™¤
attachment.lifetime = XCTAttachmentLifetimeKeepAlways;

// è®¾ç½®ä¸€ä¸ªåå­— æ–¹ä¾¿åŒºåˆ†
attachment.name = @"MyScreenshot";

[self addAttachment:attachment];
```

åœ¨æµ‹è¯•ç»“æŸåï¼Œå¯ä»¥åœ¨ Report å¯¼èˆªæ ä¸­æŸ¥çœ‹æˆªå›¾ï¼š

![](./src/3.3.png)

é™¤æ­¤ä¹‹å¤– Xcode æä¾›äº†è‡ªåŠ¨æˆªå›¾çš„åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨æ¯ä¸€ä¸ªäº¤äº’æ“ä½œä¹‹åè‡ªåŠ¨æˆªå›¾ã€‚æ­¤åŠŸèƒ½ä¼šäº§ç”Ÿå¤§é‡æˆªå›¾ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ï¼Œä¸€èˆ¬æƒ…å†µæœ€å¥½å‹¾é€‰``Delete when each test succeeds``ï¼Œéœ€è¦åœ¨ Edit Scheme -> Test -> Options ä¸­å¼€å¯ã€‚

![](./src/3.4.png)

æ‰€ä»¥ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©é€‚å½“çš„æˆªå›¾ç­–ç•¥ã€‚

### 3.4 ä»£ç è¦†ç›–ç‡

ä»£ç è¦†ç›–ç‡åœ¨ Report å¯¼èˆªæ ä¸­æŸ¥çœ‹ï¼Œå®ƒé™¤äº†å¯ä»¥å¸®ä½ ç»Ÿè®¡æµ‹è¯•ç”¨ä¾‹è¦†ç›–çš„ä»£ç ç™¾åˆ†æ¯”ï¼Œè¿˜å¯ä»¥å¸®åŠ©ä½ å‘ç°å“ªäº›ä»£ç æ˜¯æ²¡æœ‰è¢«æµ‹è¯•ç”¨ä¾‹è¦†ç›–çš„ï¼Œéœ€è¦åœ¨ Edit Scheme -> Test -> Options ä¸­å¼€å¯ã€‚

![](./src/3.6.png)


ä½ è¿˜å¯ä»¥é€‰æ‹©ç»Ÿè®¡å“ªäº› targets çš„ä»£ç è¦†ç›–ç‡ï¼Œ``all targets``è¡¨ç¤ºç»Ÿè®¡é¡¹ç›®å†…æ‰€æœ‰ targets çš„è¦†ç›–ç‡ï¼Œ``some targets``éœ€è¦ä½ æ‰‹åŠ¨æ·»åŠ  target ï¼Œåªç»Ÿè®¡æ‰‹åŠ¨æ·»åŠ çš„ target çš„è¦†ç›–ç‡ã€‚

![](./src/3.5.png)


é™¤äº†åœ¨ Report å¯¼èˆªæ ä¸­æŸ¥çœ‹ä»£ç è¦†ç›–ç‡çš„æ–¹å¼ï¼Œä½ è¿˜å¯ä»¥å€ŸåŠ©è‹¹æœæä¾›çš„å‘½ä»¤è¡Œå·¥å…·``xccov``æ¥ç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Šã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ``xccov``è¿˜èƒ½è¾“å‡º JSON æ ¼å¼çš„æŠ¥å‘Šã€‚

### 3.5 è·³è¿‡éƒ¨åˆ†æµ‹è¯•

åœ¨ Xcode 10 ä¸­æ–°å¢åŠŸèƒ½ï¼Œåœ¨ Edit Scheme -> Test -> Info -> Tests ä¸­å¯ä»¥é€šè¿‡å–æ¶ˆå‹¾é€‰ï¼Œæ¥é€‰æ‹©è·³è¿‡éƒ¨åˆ†æµ‹è¯•ç”¨ä¾‹ã€‚åœ¨ target çš„ Options é€‰é¡¹ä¸­ï¼Œ``Automatically includes new tests``ï¼Œé€‰é¡¹æ˜¯é»˜è®¤å‹¾é€‰çš„ï¼Œæ–°å»ºçš„æµ‹è¯•æ–‡ä»¶ä¼šè‡ªåŠ¨æ·»åŠ è¿›å»ã€‚
 
![](./src/3.7.png)


### 3.6 æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œé¡ºåº

é»˜è®¤æƒ…å†µä¸‹ï¼Œæµ‹è¯•ç”¨ä¾‹æ‰§è¡Œçš„é¡ºåºæ˜¯æŒ‰å­—æ¯é¡ºåºæ¥æ‰§è¡Œçš„ï¼ŒæŒ‰å›ºå®šé¡ºåºæ‰§è¡Œå¯èƒ½ä¼šä½¿ä¸€äº›éšå¼çš„ä¾èµ–å…³ç³»æ— æ³•è¢«å‘ç°ã€‚ç°åœ¨æœ‰äº†éšæœºçš„æ‰§è¡Œé¡ºåºï¼Œå°±å¯ä»¥æŒ–æ˜å‡ºé‚£äº›éšå¼çš„ä¾èµ–å…³ç³»ã€‚å¯ä»¥åœ¨ Edit Scheme -> Test -> Info -> Tests -> Options ä¸­å¼€å¯è¯¥åŠŸèƒ½ã€‚

![](./src/3.8.png)

            
### 3.7 å¹¶è¡Œæµ‹è¯•

å¹¶è¡Œæµ‹è¯•å¯ä»¥åŒæ—¶è¿›è¡Œå¤šä¸ªæµ‹è¯•ï¼Œä»è€ŒèŠ‚çœå¤§é‡æ—¶é—´ã€‚åœ¨æµ‹è¯•æ—¶ä¼šå¯åŠ¨å¤šä¸ªæ¨¡æ‹Ÿå™¨ï¼Œæ¨¡æ‹Ÿå™¨ä¹‹é—´çš„æ•°æ®éƒ½æ˜¯éš”ç¦»çš„ï¼Œå¯ä»¥åœ¨ Edit Scheme -> Test -> Info -> Tests -> Options ä¸­å¼€å¯è¯¥åŠŸèƒ½ã€‚

![](./src/3.9.png)

å¯¹äºå¹¶è¡Œæµ‹è¯•çš„ä¸€äº›å»ºè®®ï¼š

* æŸä¸ªæµ‹è¯•ç”¨ä¾‹éœ€è¦æ¶ˆè€—å¤§é‡æ—¶é—´çš„ç±»ï¼Œå¯ä»¥æ‹†åˆ†æˆå¤šä¸ªç±»å¹¶è¡Œæµ‹è¯•ï¼Œä»è€ŒèŠ‚çœæ—¶é—´ã€‚
* ä½ éœ€è¦æ¸…æ¥šå“ªäº›æµ‹è¯•åœ¨å¹¶è¡Œæ‰§è¡Œæ—¶æ˜¯ä¸å®‰å…¨çš„ï¼Œé¿å…å¹¶è¡Œæ‰§è¡Œè¿™äº›æµ‹è¯•ã€‚
* æ€§èƒ½æµ‹è¯•çš„å¯ä»¥ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ª Bundle ä¸­ï¼Œç¦ç”¨å¹¶è¡Œæ‰§è¡Œã€‚
         

## å››ã€å·¥ç¨‹å¯æµ‹æ€§

å•å…ƒæµ‹è¯•çš„ç»“æ„ï¼š

1. å‡†å¤‡è¾“å…¥
2. è¿è¡Œéœ€è¦æµ‹è¯•çš„ä»£ç 
3. éªŒè¯è¾“å‡º

å¯æµ‹è¯•ä»£ç çš„ç‰¹å¾ï¼š

* é¿å…è¿‡å¤šè¾“å…¥
* è¾“å‡ºæ˜¯å¯è§çš„
* æ²¡æœ‰éšè—çš„çŠ¶æ€

### 4.1 å¯æµ‹æ€§ Tips

* å‚æ•°åŒ–ï¼šå‡å°‘å…±äº«å•ä¾‹çš„å¼•ç”¨ï¼Œæµ‹è¯•çš„æ–¹æ³•éœ€è¦æ¥å—å‚æ•°è¾“å…¥å’Œæ˜ç¡®çš„è¾“å‡ºã€‚
* åˆ†ç¦»é€»è¾‘å’Œç»“æœï¼šæŠ½ç¦»é€»è¾‘ï¼Œæœ€ç»ˆæµ‹è¯•ä»£ç å°½é‡ç²¾ç®€ã€‚
* å¹³è¡¡å•å…ƒæµ‹è¯•å’Œ UI æµ‹è¯•ï¼šå•å…ƒæµ‹è¯•é€‚åˆæµ‹è¯•ç”¨æˆ·äº¤äº’è¡Œä¸ºæ— æ³•è¦†ç›–çš„ä»£ç ï¼Œå’Œå°è€Œå®Œæ•´çš„ä»£ç ã€‚UI æµ‹è¯•æ›´é€‚åˆæµ‹è¯•å¤§èŒƒå›´çš„åŠŸèƒ½é›†åˆã€‚

### 4.2 å¸®åŠ© UI æµ‹è¯•æ›´åŠ å®Œå–„

* ç”¨ç²¾å·§èªæ˜çš„ä»£ç ç¼©å‡ UI æµ‹è¯•çš„ä»£ç é‡
* å°†å¤æ‚çš„æŸ¥è¯¢é€»è¾‘è¿›è¡Œå°è£…
* å¯¹å¸¸è§ç»„åˆæ“ä½œçš„ UI æµ‹è¯•æµç¨‹è¿›è¡Œå°è£…
* é¿å…é€»è¾‘æ··ä¹±å’Œå†—ä½™

                          
#### 4.3 åˆç†ä½¿ç”¨å¿«æ·é”®

* é¿å…ä½¿ç”¨ macOS çš„èœå•æ 
* ä½¿é€»è¾‘ä¸Šä¸‹ç´§å¯†ï¼Œé¿å…é€»è¾‘åˆ†ç¦»
 
### 4.3 æµ‹è¯•ä»£ç çš„è´¨é‡

* å†™æµ‹è¯•ä»£ç ä¹‹å‰å¤šæ„æ€å¾ˆé‡è¦
* æµ‹è¯•ä»£ç åº”è¯¥æ”¯æ’‘ä½ çš„ App çš„æ‹“å±•
* ä¸šåŠ¡ä»£ç ä¸­çš„ç¼–ç åŸåˆ™ä¹Ÿé€‚ç”¨äºæµ‹è¯•ä»£ç 

æœ¬èŠ‚å†…å®¹æ ¹æ® [WWDC 2017 Session 414ï¼šEngineering for Testability](https://developer.apple.com/videos/play/wwdc2017/414/) ç²—ç•¥æ€»ç»“å¾—å‡ºï¼Œå¦‚æœéœ€è¦äº†è§£æ›´å¤šç›¸å…³å†…å®¹å¯ä»¥æŸ¥çœ‹ç›¸å…³è§†é¢‘ã€‚
            
## æ€»ç»“

æŒæ¡è¿™äº›æµ‹è¯•ç›¸å…³ API å¹¶ä¸éš¾ï¼Œä½†æ˜¯å¥½çš„ä»£ç éœ€è¦ç»è¿‡å®Œæ•´é¡¹ç›®çš„ç£¨ç ºå’Œæ—¶é—´çš„è€ƒéªŒã€‚åŒæ—¶ä¹Ÿå¯ä»¥å€Ÿé‰´ä¸€äº›å¼€æºé¡¹ç›®çš„æµ‹è¯•ä»£ç ï¼Œå°è¯•ç€çˆ¬ä¸Šå·¨äººçš„è‚©è†€ã€‚

## å‚è€ƒ

[WWDC 2018 Session 403ï¼šWhat's New in Testing](https://developer.apple.com/videos/play/wwdc2018/403/)

[WWDC 2017 Session 414ï¼šEngineering for Testability](https://developer.apple.com/videos/play/wwdc2017/414/)

[WWDC 2017 Session 409ï¼šWhat's New in Testing](https://developer.apple.com/videos/play/wwdc2017/409/)

[WWDC 2015 Session 406ï¼šUI Testing in Xcode](https://developer.apple.com/videos/play/wwdc2015/406/)

[WWDC 2014 Session 414ï¼šTesting in Xcode 6](https://developer.apple.com/videos/play/wwdc2014/414/)
